.. index:: URLs and URIs

.. _url-and-uris:

URLs and URIs
=============

Base URL
--------

Examples of good base URLs:

.. code-block:: http

    https://api.marktplaats.nl/v1
    https://api.marktplaats.nl/subsystem/v1.1

Not so good example (see rules below why):

.. code-block:: http

    http://open.prod.marktplaats.nl/api/subsystem/services/1.2.4


Base URL should be short
^^^^^^^^^^^^^^^^^^^^^^^^

The base URL SHOULD be short and easy to remember. The longer the domain name and path, the harder it is to use.

Https MUST be used
^^^^^^^^^^^^^^^^^^

Https MUST be used. This solves a great deal of otherwise hard to tackle security problems.

Base URL MUST end in a version number
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The version in the URL is the escape route to introduce breaking changes to the API. This should not be taken lightly
and therefore a single digit should be enough for a long time.

For clarity, the version MUST be preceded by a ``v``.

Base URL's version number MAY include a minor version
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

See `versioning <60-versioning.rst>`_ for more information on when to use a minor version.

URL and URI naming
------------------

Document names SHOULD be a singular noun
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A URI representing a document resource SHOULD be named with a singular noun or noun phrase path segment.
For example, the URI for a single seller profile document would have the singular form:

.. code-block:: http

    https://api.marktplaats.nl/v1/users/1/profile


Collection names SHOULD be a plural noun
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A URI identifying a store of resources SHOULD be named with a plural noun, or noun phrase, as its path segment.
For example, the URI for a store of categories may use the plural noun form as follows:

.. code-block:: http

    https://api.marktplaats.nl/v1/categories


Forward slash separator (``/``) MUST be used to indicate a hierarchical relationship
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The forward slash (``/``) character MUST be used in the path portion of the URI to indicate a hierarchical relationship between resources. For example:

.. code-block:: http

    https://api.marktplaats.nl/v1/categories/91/advertisements


URIs SHOULD not have a trailing forward slash (``/``)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

As the last character within a URI’s path, a forward slash (``/``) adds no semantic value and may cause confusion.
REST APIs should not expect a trailing slash and SHOULD not include them in the links that they provide to clients.

Many web components and frameworks will treat the following two URIs equally:

.. code-block:: http

    https://api.marktplaats.nl/v1/categories/
    https://api.marktplaats.nl/v1/categories

However, every character within a URI counts toward a resource’s unique identity.
Two different URIs must map to two different resources. If the URIs differ, then so do the resources, and vice versa.
Therefore, a REST API must generate and communicate clean URIs and SHOULD be intolerant of any client’s attempts to
identify a resource imprecisely.

Redirects (e.g. 301 Moved Permanently) from one version to the other MUST NOT be used. Some clients don't support
redirects and we need to keep this consistent over our separate APIs.

Hyphens (``-``) SHOULD be used to improve the readability of URIs, not underscores (``_``)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

To make your URIs easy for people to scan and interpret, use the hyphen (``-``) character to improve the readability of
names in long path segments.
Anywhere you would use a space or hyphen in English, you should use a hyphen in a URI. For example:

.. code-block:: http

    https://api.marktplaats.nl/v1/this-is-an-endpoint-with-a-large-name


URI paths MUST use lowercase letters
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Lowercase letters are preferred in URI paths since capital letters can sometimes cause problems.
RFC 3986 defines URIs as case-sensitive except for the scheme and host components.
For example:

.. code-block:: http

    https://api.example.restapi.org/my-folder/my-doc
    HTTPS://API.EXAMPLE.RESTAPI.ORG/my-folder/my-doc
    https://api.example.restapi.org/My-Folder/my-doc

The first URL is fine and RFC3986 considers the second url to be identical to URL #1. But the third URL is not the same
as URIs one and two, which may give unnecessary confusion.

Parameters inside the URI path are excluded from this rule.

Query parameters
----------------

The query component of a URI SHOULD be used to filter collections or stores
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A URI’s query component is a natural fit for supplying search criteria to a collection or store.

Example :

.. code-block:: javascript

    GET /v1/users?casUser=true HTTP/1.1
    Host: api.marktplaats.nl

    HTTP/1.1 200 OK
    Content-Type: application/json
    {
        "_links": {
            "self": { "href": "/users" },
        },
        "_embedded": {
            "https://api.marktplaats.nl/v1/rels/user": [{
               "_links": {
                 "self": { "href": "/users/2" },
               },
               "name": "Richard",
               "email": "2@marktplaats.nl",
               "casUser" : true
            }]
        },
        "totalResults": 10
    }

The query component of a URI SHOULD be used to paginate collections or store results
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A REST API client SHOULD use the query component to paginate collections and store results with the ``offset`` and ``limit`` parameters.

The ``limit`` parameter specifies the maximum number of contained elements to return in the response.
The ``offset`` parameter specifies the zero-based index of the first element to return in the response.

Example :

.. code-block:: javascript

    GET /v1/users?offset=0&limit=2 HTTP/1.1
    Host: api.marktplaats.nl

    HTTP/1.1 200 OK
    Content-Type: application/json

    {
        "_links": {
            "self": { "href": "/users" },
            "next": { "href": "/users?offset=1&limit=2" },
            "find": { "href": "/users{?id}", "templated": true }
        },
        "_embedded": {
            "https://api.marktplaats.nl/v1/rels/user": [{
               "_links": {
                 "self": { "href": "/users/1" },
               },
               "sellername": "Robin",
               "email": "1@marktplaats.nl",
               "casUser" : false
             },{
               "_links": {
                 "self": { "href": "/users/2" },
               },
               "name": "Richard",
               "email": "2@marktplaats.nl",
               "casUser" : true
            }]
        },
        "totalResults": 10
    }



.. _body-parameter:

The ``_body`` parameter SHOULD be used to include/exclude a response body
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

By default responses contain a body, even if it is mostly the same as what was posted. The ``_body`` parameter SHOULD be
used to change this behavior.

Parameter ``_body`` takes values ``true`` (the default) or ``false``.

Example:

.. code-block:: javascript

    POST https://api.marktplaats.nl/v1/users?_body=false HTTP/1.1
    Host: api.marktplaats.nl

    {
        "username": "testUser",
        "zipcode": "1097DN",
        "email": "test@marktplaats.nl"
    }


    HTTP/1.1 201 Created
    Location: /v1/users/95

Note: the ``_body`` parameter SHOULD be supported by each method on each entity.

.. _method-parameter:

Mimicking request methods
^^^^^^^^^^^^^^^^^^^^^^^^^

Some clients do not support all methods. Therefore we support other ways to mimic any request method:

1. The value of ``_method`` URL parameter MUST be interpreted as the intended request method.
2. The value of request header ``X-HTTP-METHOD-OVERRIDE`` MUST be interpreted as the intended request method.
3. The value of request header ``X-HTTP-METHOD`` MAY be interpreted as the intended request method.
4. The value of request header ``X-METHOD-OVERRIDE`` MAY be interpreted as the intended request method.

These ways MUST be evaluated in the given order; the first found value overrides all following. When during evaluation
of a parameter or header value an unknown or illegal method is encountered, an ``400`` error response MUST be given,
independent of the correctness of other available values.

Example:

.. code-block:: javascript

    POST /v1/advertisements/95?_method=PATCH HTTP/1.1
    Host: api.marktplaats.nl
    Content-Type: application/json-patch+json
    If-Match: "abc123"

    [
        { "op": "replace", "path": "/title", "value": "new advertisement title" },
        { "op": "replace", "path": "/price", "value": 9000 }
    ]

is interpreted as a ``PATCH`` request.

A failure example:

.. code-block:: javascript

    POST /v1/advertisements/95?_method=BLABLA HTTP/1.1
    Host: api.marktplaats.nl
    X-HTTP-METHOD-OVERRIDE: PATCH
    Content-Type: application/json-patch+json
    If-Match: "abc123"

    [
        { "op": "replace", "path": "/title", "value": "new advertisement title" },
        { "op": "replace", "path": "/price", "value": 9000 }
    ]

results in an ``400`` error response because the ``_method`` parameter contains an illegal method, even though the
``X-HTTP-METHOD-OVERRIDE`` header does contain a correct value.


The ``_callback`` parameter MAY be used to return a jsonp response
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A ``_callback`` parameter MAY be used in any ``GET`` call to have the results wrapped in a JSON function.
This is typically used when browsers want to embed content in web pages by getting around cross domain
issues. The response includes the same data output as the regular API, plus the relevant HTTP Header information.

The content type of the response MUST be ``application/javascript``.

Example:

.. code-block:: javascript

    GET /v1/users?_callback=foo HTTP/1.1
    Host: api.marktplaats.nl

    HTTP/1.1 200 OK
    Content-Type: application/javascript
    foo({
        "_links": {
            "self": { "href": "/users" },
        },
        "_embedded": {
            "https://api.marktplaats.nl/v1/rels/user": [{
               "_links": {
                 "self": { "href": "/users/2" },
               },
               "name": "Richard",
               "email": "2@marktplaats.nl",
               "casUser" : true
            }]
        },
        "totalResults": 10
    })

The ``_expand`` parameter MAY be used for zooming
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Zooming is an optional technique that allows linked resources to be embedded. The embedded resources are serialized as
described by [HAL](http://stateless.co/hal_specification.html).

Example :

.. code-block:: javascript

    GET /v1/categories/92?_expand=parent-category HTTP/1.1
    Host: api.marktplaats.nl

    HTTP/1.1 200 OK
    Content-Type: application/json
    ETag: "7dsyiuh44aa"

    {
        "_links": {
            "self": { "href": "/v1/categories/92" },
            "describedby": { "href": "https://api.marktplaats.nl/v1/docs/resources/category" },
            "https://api.marktplaats.nl/v1/docs/rels/parent-category": { "href": "/v1/categories/91" }
        },
        "_embedded": {
            "https://api.marktplaats.nl/v1/rels/parent-category": [{
               "_links": {
                 "self": { "href": "/v1/categories/91" },
               },
               "id": 91,
               "name": "Auto's, motors en andere voertuigen",
               "shortName": "Auto's"
            }]
        },
        "id": 92,
        "parentCategoryId": 91,
        "name": "Alpha romeo",
        "shortName": "Alpha romeo"
    }


TODO: look into <http://www.etsy.com/developers/documentation/getting_started/resources> to allow pagination.


.. _include-and-exclude-parameters:

The ``_include`` and ``_exclude`` parameters MAY be used for selecting fields
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The ``_include`` and ``_exclude`` parameters MAY be used to select fields. If both parameters are present, only the
``_include`` parameter MUST be used.

Both fields have a similar format. A list of comma separated field names are valid arguments for both ``_include`` and ``_exclude``.

TODO: look into <http://www.etsy.com/developers/documentation/getting_started/resources> to allow pagination

Example :

    TODO

.. _prettyprint-parameter:

The ``_prettyprint`` parameter MAY be used to pretty print the response
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Implementation MAY support the ``?_prettyprint`` parameter to make it easier for people to view, read and understand
resources. Formatting SHOULD be enabled when the parameter is present and does not have the value ``false``.

Consider enabling pretty printing by default for documentation resources only (e.g. the ``/`` resource).

Example :

.. code-block:: javascript

    GET /v1/categories/95?_prettyprint HTTP/1.1
    Host: api.marktplaats.nl

    HTTP/1.1 200 OK
    Content-Type: application/json

    {
        "_links": {
            "self": { "href": "/v1/categories/95" },
            "describedby": { "href": "https://api.marktplaats.nl/v1/docs/resources/category" },
            "https://api.marktplaats.nl/v1/docs/rels/parent_category": { "href": "/v1/categories/91" }
        },
        "id": 95,
        "parentCategoryId": 91,
        "name": "BMW",
        "shortName": "BMW"
    }

Use of underscore character
^^^^^^^^^^^^^^^^^^^^^^^^^^^

The underscore character is used to clearly identify shared URL parameters. The underscore is nicely consistent with how it is used in HAL resource representations.

Parameter names MUST not start with an underscore unless they are described in these guidelines.
